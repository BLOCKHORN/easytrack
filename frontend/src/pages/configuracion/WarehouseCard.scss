/* ==========================================================================
   WarehouseCard — Estantes (rejilla + renombrado) & Carriles (palette) + Guardar
   Con viewport + auto-fit/zoom para no cortar filas largas
   ========================================================================== */
.warehouse-card{
  --bd: var(--border, #e6e9ef);
  --mut: var(--muted, #64748b);
  --ink: var(--ink, #0f172a);
  --ring: rgba(99, 91, 255, .28);

  color: var(--ink);

  /* Header */
  .card__header.warehouse-card__header{
    display:grid !important;
    grid-template-columns:auto 1fr !important;
    gap:12px !important; align-items:center !important;
    min-height:76px !important; padding:12px 14px !important;
    border:1px solid var(--bd); border-radius:14px;
    background:linear-gradient(180deg, rgba(2,6,23,.02), rgba(2,6,23,.04));
  }
  .wh-badge{
    width:clamp(46px,5vw,56px); height:clamp(46px,5vw,56px);
    border-radius:999px; display:grid; place-items:center; color:#fff;
    background: conic-gradient(from 220deg, #a5b4fc, #22d3ee, #fca5a5, #a5b4fc);
    box-shadow: inset 0 8px 20px rgba(99,91,255,.18);
    svg{ font-size:1.1rem; opacity:.95; }
  }
  .wh-headtext{ display:flex; flex-direction:column; gap:2px; min-width:0; }
  .wh-title{ margin:0; font-weight:900; letter-spacing:.2px; line-height:1.2; font-size:clamp(1.02rem,2vw,1.12rem); }
  .wh-subtitle{ margin:0; color:var(--mut); text-wrap:balance; }

  &__body{ display:grid; gap:14px; }

  /* Botones base */
  .btn{
    --btn-bd: var(--bd);
    --btn-bg: #ffffff;
    --btn-ink: #0b1220;
    display:inline-flex; align-items:center; gap:8px;
    height:36px; padding:0 12px; border:1px solid var(--btn-bd);
    background:var(--btn-bg); color:var(--btn-ink);
    border-radius:10px; font-weight:800; cursor:pointer;
    transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;
  }
  .btn:hover{ background:#f8fafc; }
  .btn--xs{ height:28px; padding:0 10px; border-radius:9px; font-size:.875rem; }
  .btn--sm{ height:32px; padding:0 10px; border-radius:9px; }
  .btn--ghost{ --btn-bg:transparent; --btn-bd: color-mix(in srgb, var(--bd) 70%, transparent); }
  .btn--primary{ --btn-bg:#2563eb; --btn-bd:#2563eb; --btn-ink:#fff; background:#2563eb; color:#fff; border-color:#2563eb; }
  .btn--primary:hover{ background:#1d4ed8; border-color:#1d4ed8; }

  /* Modo + acciones */
  .mode-banner{
    display:flex; align-items:center; gap:14px;
    margin:10px 0 0; padding:12px;
    border:1px solid var(--bd); border-radius:14px;
    background:linear-gradient(180deg, #ffffff, #fbfcff);
    box-shadow:0 8px 18px rgba(15,23,42,.04);
  }
  .mode-pills{ display:flex; gap:8px; }
  .mode-pill{
    padding:10px 16px; border:1px solid var(--bd); border-radius:999px;
    background:#fff; font-weight:800; cursor:pointer;
    transition: background .15s ease, border-color .15s ease, box-shadow .15s ease, transform .08s ease;
  }
  .mode-pill:hover{ background:#f8fafc; transform:translateY(-1px); }
  .mode-pill.is-active{
    background:#eef4ff; border-color:#dbe7ff; box-shadow:0 6px 16px rgba(15,23,42,.06);
  }
  .mode-actions{ margin-left:auto; display:flex; align-items:center; gap:10px; }
  .mode-status{ color:#475569; }
  .mode-status strong{ color:#0f172a; }

  /* Toolbar */
  .wh-toolbar{
    display:grid; gap:14px;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    border:1px solid var(--bd); border-radius:14px;
    background:#fff; padding:12px; margin-top:4px;
  }
  .tool-col{ display:grid; gap:8px; align-content:start; }
  .tool-title{ font-weight:800; color:#111827; font-size:.95rem; }
  .seg-row{ display:flex; flex-wrap:wrap; gap:8px; }

  .seg{
    padding:8px 12px; border:1px solid var(--bd); border-radius:999px;
    background:#fff; color:#0b1220; cursor:pointer; font-weight:700; font-size:.92rem;
    transition: background .15s ease, border-color .15s ease;
  }
  .seg:hover{ background:#f8fafc; }
  .seg.is-active{ background:#eef4ff; border-color:#dbe7ff; }

  /* Zoom tools */
  .tool-zoom{
    .chk-inline{
      display:flex; align-items:center; gap:8px; font-weight:700; color:#0b1220;
      input{ width:16px; height:16px; }
    }
    .zoom-row{
      display:flex; align-items:center; gap:8px;
      input[type="range"]{ width:160px; }
      .zoom-val{ min-width:42px; text-align:right; font-variant-numeric: tabular-nums; font-weight:800; color:#0f172a; }
    }
  }

  .tool-spacer{ flex:1 1 auto; }
  @media (max-width: 1160px){
    .wh-toolbar{ grid-template-columns: 1fr; }
    .mode-banner{ flex-wrap:wrap; }
    .mode-actions{ width:100%; justify-content:space-between; }
  }

  /* === Viewport/Scaling (lo importante para evitar cortes) === */
  .boardViewport{
    position: relative;
    overflow: auto;            /* Scroll de seguridad si hiciera falta */
    max-height: min(70vh, 800px);
    border:1px solid var(--bd); border-radius:14px;
    background:#fff;
    padding:0;                 /* sin padding aquí; el del board se calcula */
  }
  .boardScale{
    transform-origin: top left;
    will-change: transform;
    /* Evita que hijos creen stacking raro al escalar */
    isolation: isolate;
  }

  /* Boards */
  .racksBoard, .lanesBoard{
    border:0; /* el marco lo pone el viewport */
    padding:12px;               /* ojo: usado en el cálculo JS (BOARD_PADDING_X) */
    display:grid; gap:12px;
  }
  .cell{
    position:relative; border:1px dashed color-mix(in srgb, var(--bd) 75%, transparent);
    border-radius:12px; display:flex; align-items:center; justify-content:center;
    transition:border-color .12s ease, background .12s ease;
    &:hover{ background:#f8fafc; border-color:#dbe7ff; }
  }

  /* -------- Carriles -------- */
  .laneCard{
    --tape:#f59e0b;
    --tape-h: 6px;
    position:relative; width:100%;
    border-radius:12px; border:1px solid var(--bd);
    background:
      linear-gradient(0deg, var(--tape) 0 0) top/100% var(--tape-h) no-repeat,
      #fff;
    color:#0f172a; padding:12px;
    box-shadow:0 8px 16px rgba(15,23,42,.06);
  }
  .laneRow{ display:flex; align-items:center; gap:10px; }
  .laneName{
    font-weight:800; padding:4px 10px; border:1px solid var(--bd); border-radius:999px; background:#fff;
  }
  .laneSwatch{
    margin-left:auto;
    width:16px; height:16px; border-radius:999px; border:2px solid #fff;
    box-shadow:0 0 0 1px var(--bd);
    cursor:pointer;
  }

  .lanePalette{
    position:absolute; right:10px; top:calc(100% + 8px); z-index:3;
    min-width:240px;
    background:#fff; border:1px solid var(--bd); border-radius:12px;
    padding:10px; box-shadow:0 14px 30px rgba(15,23,42,.16);
  }
  .lanePalette::before{
    content:""; position:absolute; right:16px; top:-7px;
    width:12px; height:12px; background:#fff; border-left:1px solid var(--bd); border-top:1px solid var(--bd);
    transform:rotate(45deg);
  }
  .palette-title{
    font-size:.75rem; font-weight:900; color:#475569; letter-spacing:.2px;
    margin:2px 0 6px;
  }
  .palette-row{ display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px; }
  .palette-grid{
    display:grid; grid-template-columns: repeat(10, 18px);
    gap:6px; margin-bottom:8px;
  }
  .chip-color{ width:18px; height:18px; border-radius:999px; box-shadow:0 0 0 1px var(--bd); }
  .chip-color.is-active{ box-shadow:0 0 0 2px color-mix(in srgb, var(--ring) 60%, transparent); }
  .palette-actions{ display:flex; justify-content:flex-end; }

  /* -------- Estantes -------- */
  .rackCard{
    width:100%;
    border-radius:12px; border:1px solid var(--bd);
    background:
      linear-gradient(0deg, #93c5fd 0 0) top/100% 6px no-repeat,
      #fff;
    box-shadow:0 6px 14px rgba(15,23,42,.06);
  }
  .rackHead{
    display:flex; align-items:center; gap:10px; padding:10px 12px; border-bottom:1px dashed var(--bd);
    background:linear-gradient(90deg, rgba(147,197,253,.18), rgba(186,230,253,.18));
  }
  .rackHead__name{
    font-weight:900; letter-spacing:.2px; border:1px solid var(--bd); border-radius:10px; padding:6px 10px; background:#fff;
    cursor:text;
  }
  .rackHead__name--static{ cursor:default; }
  .shelfOps{ margin-left:auto; display:flex; align-items:center; gap:8px; }
  .iconbtn{
    width:32px; height:32px; border-radius:8px; border:1px solid var(--bd);
    background:#fff; display:grid; place-items:center; cursor:pointer;
    transition: background .12s ease, border-color .12s ease;
  }
  .iconbtn:hover{ background:#f8fafc; }
  .shelf-pill{
    min-width:28px; height:28px; padding:0 8px; display:grid; place-items:center;
    border:1px solid var(--bd); border-radius:999px; font-weight:900; background:#fff;
  }

  .rackBody{ padding:10px 12px 14px; display:grid; gap:8px; }
  .rackSlot{
    background: linear-gradient(180deg, #ffffff, #f6f7fb);
    border:1px solid var(--bd); border-radius:10px;
    padding:6px 8px; box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
  }
  .slotInput{
    width:100%; height:36px; border:0; background:transparent; font-weight:700; letter-spacing:.2px;
    &::placeholder{ color:#94a3b8; }
    &:focus-visible{ outline:none; box-shadow:0 0 0 3px var(--ring); border-radius:8px; background:#fff; }
  }
  .slotInput[readonly]{ cursor:default; }

  /* Footer */
  .wh-footerbar{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    margin-top:4px; padding-top:8px; border-top:1px dashed var(--bd);
  }
  .wh-stats{ color:var(--mut); font-weight:700; }
  .wh-hint{ color:var(--mut); display:flex; align-items:center; gap:6px; }

  :focus-visible{ outline:2px solid var(--ring); outline-offset:2px; }

  /* Responsive */
  @media (max-width: 900px){
    .racksBoard{ grid-template-columns: 1fr !important; }
  }
  @media (max-width: 720px){
    .lanesBoard, .racksBoard{ gap:10px; padding:12px; }
    .palette-grid{ grid-template-columns: repeat(8, 18px); }
    .mode-actions{ flex-wrap:wrap; gap:8px; }
    .boardViewport{ max-height: 60vh; }
  }
}
