/* ===========================
   Import Wizard (scoped)
   =========================== */

.import-wizard{
  --iw-bg: var(--nav-panel, #111318);
  --iw-surface: var(--nav-surface, #14161b);
  --iw-border: var(--nav-border, rgba(255,255,255,.10));
  --iw-text: var(--nav-txt, #e5e7eb);
  --iw-muted: var(--nav-txt-2, #cbd5e1);
  --iw-accent: var(--acc-2, #34d399);
  --iw-accent-2: var(--acc-1, #60a5fa);

  background: var(--iw-bg);
  border: 1px solid var(--iw-border);
  border-radius: 14px;
  padding: 16px;
  color: var(--iw-text);
  box-shadow: 0 6px 18px rgba(0,0,0,.25);

  .iw-head{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    margin-bottom: 12px;

    h3{
      margin:0; font-weight:650; letter-spacing:.2px; color:var(--iw-text);
    }
    .iw-steps{
      font-size: 12px;
      color: color-mix(in oklab, var(--iw-text) 65%, black);
      background: rgba(255,255,255,.04);
      border: 1px solid var(--iw-border);
      padding: 4px 8px;
      border-radius: 999px;
    }
  }

  .iw-muted{ color: var(--iw-muted); margin-top: 0; }

  .iw-example{
    display:flex; gap:10px; flex-wrap:wrap; margin: 6px 0 12px 0;
    code{
      background:#0c0d10; border:1px solid var(--iw-border); border-radius:10px;
      padding:6px 8px; color:#e5e7eb; opacity:.9; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
  }

  /* -------- LinedTextarea -------- */
  .iw-lined{
    position: relative; display:flex; width:100%;
    border: 1px solid var(--iw-border);
    border-radius: 12px; overflow: hidden;
    background: #0c0d10;

    /* gutter */
    &__gutter{
      width: 48px; flex: 0 0 48px; overflow: auto;
      background: #0b0d11 linear-gradient(to bottom, transparent 31px, rgba(255,255,255,.04) 32px) 0 0 / 100% 32px;
      border-right: 1px solid var(--iw-border);
      scrollbar-width: none;
      &::-webkit-scrollbar{ display:none; }
    }
    &__num{
      height: 32px; line-height: 32px; text-align: right; padding: 0 10px;
      font-size: 12px; color: color-mix(in oklab, var(--iw-text) 60%, black);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      user-select: none;
    }

    /* textarea con rejilla de renglones */
    &__textarea{
      appearance:none; border:0; outline:0; resize: vertical;
      width: 100%; min-height: 120px; padding: 8px 12px;
      color: var(--iw-text); background: #0c0d10;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      line-height: 32px;  /* clave para alinear con gutter */
      background-image:
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 100% 32px;
      caret-color: var(--iw-accent-2);
    }
  }

  .iw-bar{
    display:flex; align-items:center; gap:12px; margin-top:12px;

    .iw-threshold{
      font-size: 12px; color: color-mix(in oklab, var(--iw-text) 80%, black);
      display:flex; align-items:center; gap:8px;
      input{
        width: 90px;
        background:#0c0d10; color:var(--iw-text);
        border:1px solid var(--iw-border); border-radius: 10px; padding: 6px 8px;
      }
    }
    .spacer{ flex:1; }
  }

  /* -------- Botones -------- */
  .btn{
    cursor:pointer; border-radius:12px; padding:10px 14px;
    border:1px solid var(--iw-border); background: var(--iw-surface); color: var(--iw-text);
    transition: transform .12s, background .12s, border-color .12s, opacity .12s;
    &:hover{ background: color-mix(in oklab, var(--iw-surface) 70%, white); }
    &:active{ transform: translateY(1px); }
    &:disabled{ opacity:.5; cursor:not-allowed; }
  }
  .btn--primary{
    background: var(--iw-accent-2); color:#0b1016;
    border-color: color-mix(in oklab, var(--iw-accent-2) 50%, black);
    font-weight:700;
  }
  .btn--accent{
    background: var(--iw-accent); color:#0b110e; font-weight:700;
    border-color: color-mix(in oklab, var(--iw-accent) 60%, black);
  }
  .btn--ghost{ background:transparent; }

  /* -------- Tabla / Cards -------- */
  .iw-table-wrap{
    position: relative;
    border:1px solid var(--iw-border);
    border-radius:12px; background:#0f1116;
    overflow: hidden; /* desktop por defecto */

    /* Scroll estilizado para la tabla */
    .iw-table{
      width: 100%; border-collapse: collapse; font-size: 14px;
      thead tr{
        position: sticky; top: 0; z-index: 2;
        background: #151922; box-shadow: 0 1px 0 rgba(255,255,255,.06);
      }
      th, td{
        padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,.06);
        color: #e5e7eb; text-align: left; white-space: nowrap;
      }
      .col-idx{ width: 64px; color: color-mix(in oklab, var(--iw-text) 70%, black); }
      .col-conf{ width: 96px; }

      tbody tr{
        background: transparent;
        transition: background .12s;
        &:nth-child(odd){ background: rgba(255,255,255,.02); }
        &:hover{ background: rgba(96,165,250,.08); }
      }

      td.is-missing{
        color: #fca5a5;
        background-image: linear-gradient( to right, rgba(252,165,165,.08), transparent );
      }

      .muted{ opacity:.6; }
    }

    /* Cards para móvil (se activa con media query) */
    .iw-cards{ display: none; padding: 8px; }
    .iw-card{
      border:1px solid var(--iw-border); border-radius:12px;
      background: #0f1116; padding: 10px 12px; margin: 8px 0;
    }
    .iw-card__top{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:6px;
      .badge{
        font-size: 12px; padding: 2px 8px; border-radius: 999px;
        border:1px solid rgba(255,255,255,.16); background: rgba(255,255,255,.05);
        color: color-mix(in oklab, var(--iw-text) 85%, black);
      }
    }
    .iw-card__row{
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
      padding: 6px 0; border-top: 1px dashed rgba(255,255,255,.08);
      &:first-of-type{ border-top: 0; }
      .k{ font-size: 12px; color: var(--iw-muted); }
      .v.is-missing{ color: #fca5a5; }
    }
  }

  /* -------- Pills de confianza -------- */
  .pill{
    display:inline-block; padding: 2px 8px; border-radius: 999px;
    font-weight: 700; font-variant-numeric: tabular-nums;
    border: 1px solid currentColor;
  }
  .pill--high{ color:#b8f3dc; background: rgba(52,211,153,.18); border-color: rgba(52,211,153,.35); }
  .pill--mid{  color:#cfe7ff; background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.35); }
  .pill--low{  color:#ffd6b8; background: rgba(251,146,60,.18);  border-color: rgba(251,146,60,.35); }

  .iw-actions{
    display:flex; gap:12px; margin-top:12px;
    .spacer{ flex:1; }
  }
  .iw-actions--center{
    justify-content: center;
  }

  .iw-done{
    text-align:center; padding: 20px 4px;
    h4{ margin:0 0 6px 0; }
  }

  /* -------- Responsive -------- */
  @media (max-width: 880px){
    .iw-table{ display:none; }
    .iw-cards{ display:block; }
  }

  /* ====== FIX MÓVIL: evita “saltos” con sticky + overflow ====== */
  @media (max-width: 768px){
    .iw-table-wrap{
      overflow: visible; /* clave para eliminar el bug con sticky */
    }
    .iw-table-wrap .iw-table{
      thead tr{
        position: static;   /* desactiva sticky solo en móvil */
        top: auto;
        box-shadow: none;
        background: #151922;
      }
      thead th{ position: static; }
    }
  }

  @media (max-width: 720px){
    padding: 12px;
    .iw-lined__gutter{ width: 40px; flex-basis: 40px; }
    .iw-lined__num{ font-size: 11px; }
    .iw-lined__textarea{ line-height: 28px; background-size: 100% 28px; }
  }

  @media (max-width: 420px){
    .iw-head{ flex-direction: column; align-items: flex-start; gap:6px; }
    .iw-bar{ flex-wrap: wrap; }
  }
}

/* === Overrides mínimos para garantizar contraste (por si hay estilos globales) === */
.import-wizard table thead tr{ background:#151922; }
.import-wizard .btn.btn--primary{ background: var(--iw-accent-2); color:#0b1016; }
/* Avisos */
  .iw-alert{
    border: 1px solid var(--iw-border);
    border-radius: 12px;
    padding: 10px 12px;
    margin-bottom: 10px;
    background: rgba(255,255,255,.03);
    &--danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
    }
    &__title{
      font-weight: 700; margin-bottom: 4px;
      color: #fee2e2;
    }
    &__body{ color: #fca5a5; }
  }

  .iw-link{
    color: #93c5fd; text-decoration: underline; cursor: default;
  }

  .iw-company-cell{
    display:flex; align-items:center; gap:8px; flex-wrap: wrap;
  }

  .tag{
    font-size: 11px; line-height: 1;
    padding: 4px 8px; border-radius: 999px; border: 1px solid currentColor;
    &--danger{ color:#fecaca; background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.35); }
    &.m-left{ margin-left: 8px; }
  }

  /* Resalte de fila con empresa desconocida */
  .row-unknown{
    background-image: linear-gradient(to right, rgba(239,68,68,.07), transparent);
  }

