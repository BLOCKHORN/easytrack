/* ==========================================================================
   VerEstantes.scss — vista de almacén (auto-scale + nombres de config)
   ========================================================================== */

.ver-estantes {
  /* Tokens */
  --surface:     var(--ep-surface, #ffffff);
  --surface-2:   var(--ep-surface-2, #f8fafc);
  --surface-3:   var(--ep-surface-3, #f1f5f9);
  --elev:        var(--ep-elev, #0f172a);
  --border:      var(--ep-border, #e5e7eb);
  --border-2:    var(--ep-border-2, #e2e8f0);
  --text:        var(--ep-text, #0b1220);
  --muted:       var(--ep-muted, #475569);
  --brand:       var(--ep-brand, #2563eb);
  --brand-rgba:  rgba(37, 99, 235, .14);
  --brand-ring:  rgba(37, 99, 235, .36);
  --success:     #16a34a;
  --danger:      #ef4444;
  --warning:     #f59e0b;

  --radius-lg:   16px;
  --radius-md:   12px;
  --radius-sm:   10px;

  --control-h:   44px;
  --gap:         12px;

  /* widths base para auto-scale (coinciden con JSX consts) */
  --rack-cell-w: 340px;
  --lane-cell-w: 280px;

  color: var(--text);
  background: var(--surface);
  padding: clamp(16px, 2vw, 28px);
  position: relative;
  isolation: isolate;

  /* ================= CABECERA ================= */
  .titulo-bar {
    position: relative;
    border: 1px solid var(--border);
    border-radius: calc(var(--radius-lg) + 2px);
    background:
      radial-gradient(900px 220px at 100% -20%, color-mix(in srgb, var(--brand) 14%, #fff), transparent 60%),
      linear-gradient(180deg, var(--surface-2), var(--surface));
    box-shadow: 0 10px 30px rgba(2,6,23,.06), inset 0 1px 0 rgba(255,255,255,.55);
    padding: clamp(16px, 1.6vw, 22px);
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 12px;

    h2 {
      margin: 0;
      display: inline-flex; align-items: center; gap: 10px;
      font-size: clamp(22px, 3vw, 34px);
      font-weight: 900; letter-spacing: -0.015em; line-height: 1.1;
      background: linear-gradient(90deg, var(--elev), color-mix(in srgb, var(--brand) 26%, var(--elev)));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      padding-bottom: 6px; position: relative;
      .icono { color: var(--brand); filter: drop-shadow(0 2px 6px rgba(37,99,235,.25)); }
      &::after { content:''; position: absolute; left: 0; bottom: 0; width: 46%; height: 3px; border-radius: 3px; background: linear-gradient(90deg, var(--brand), transparent 85%); }
    }

    .resumen { display: grid; grid-auto-flow: column; gap: 10px; }
    .resumen .chip {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 10px 12px;
      font-weight: 800; color: var(--elev);
    }
    .resumen .chip--accent { background: var(--brand-rgba); border-color: color-mix(in srgb, var(--brand) 36%, #fff); color: color-mix(in srgb, var(--brand) 88%, #000); }

    @media (max-width: 900px) {
      grid-template-columns: 1fr;
      .resumen { grid-auto-flow: row; grid-template-columns: repeat(2, minmax(0,1fr)); }
      .resumen .chip:last-child { grid-column: 1 / -1; }
    }
  }

  /* ================= TOOLBAR ================= */
  .toolbar {
    margin-top: 14px;
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 12px;
    align-items: center;

    @media (max-width: 980px) { grid-template-columns: 1fr; }

    .leyenda {
      display: inline-flex; gap: 10px; flex-wrap: wrap;
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md);
      padding: 8px 10px;
      .leg-item { display: inline-flex; align-items: center; gap: 8px; font-weight: 800; color: var(--muted); }
      .dot { width: 12px; height: 12px; border-radius: 50%; box-shadow: inset 0 0 0 2px rgba(255,255,255,.6); }
      .dot.neutra  { background: #94a3b8; }
      .dot.verde   { background: #22c55e; }
      .dot.naranja { background: #f59e0b; }
      .dot.rojo    { background: #ef4444; }
    }

    .filtros {
      display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center;

      @media (max-width: 720px) { grid-template-columns: 1fr; }

      .input-icon {
        height: var(--control-h);
        display: flex; align-items: center;
        border: 1px solid var(--border); border-radius: var(--radius-md);
        padding: 0 12px; background: var(--surface);
        box-shadow: 0 4px 12px rgba(2,6,23,.04);
        svg { color: var(--muted); margin-right: 8px; }
        input { flex: 1 1 auto; height: 100%; border: 0; outline: 0; background: transparent; color: var(--elev); font-size: 15px; }
        .clear { border: 0; background: transparent; color: var(--muted); padding: 6px; border-radius: 8px; cursor: pointer; }
        .clear:hover { background: var(--surface-2); color: var(--elev); }
      }

      .toggle {
        display: inline-flex; align-items: center; gap: 10px; user-select: none;
        .label { color: var(--muted); font-weight: 800; }
        input { display: none; }
        .slider {
          width: 52px; height: 28px; border-radius: 999px; background: var(--surface-2); border: 1px solid var(--border);
          position: relative; transition: background .15s, border-color .15s;
        }
        .slider::after {
          content:''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; border-radius: 50%;
          background: #fff; border: 1px solid var(--border); box-shadow: 0 2px 6px rgba(2,6,23,.12);
          transition: transform .18s ease;
        }
        input:checked + .slider { background: var(--brand-rgba); border-color: color-mix(in srgb, var(--brand) 36%, #fff); }
        input:checked + .slider::after { transform: translateX(24px); }
      }

      .acciones { display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; }
      .btn-ghost {
        height: var(--control-h); padding: 0 12px; border-radius: var(--radius-md);
        border: 1px solid var(--border); background: var(--surface-2); color: var(--elev); font-weight: 900; cursor: pointer;
        transition: background .15s, transform .05s, box-shadow .15s;
      }
      .btn-ghost:hover { background: var(--surface-3); }
    }
  }

  /* ================= ESTADOS ================= */
  .skeleton { margin-top: 16px; display: grid; gap: 12px; }
  .skeleton .row { height: 66px; border-radius: var(--radius-md); border: 1px solid var(--border); background: linear-gradient(90deg, var(--surface-2), var(--surface-3), var(--surface-2)); animation: bpShimmer 1.1s linear infinite; }
  @keyframes bpShimmer { from { background-position: -180px 0 } to { background-position: 180px 0 } }

  .estado-error, .estado-vacio {
    margin-top: 16px; padding: 18px; border: 1px dashed var(--border); border-radius: var(--radius-md);
    background: var(--surface-2); color: var(--muted);
  }

  /* ================= FIT WRAPPERS (auto-scale) ================= */
  .fit-wrapper {
    width: 100%;
    overflow: hidden; /* clave: nunca scroll horizontal */
    --zoom: 1;
  }
  .fit-wrapper > .grid-estantes,
  .fit-wrapper > .lanes-matrix {
    transform: scale(var(--zoom));
    transform-origin: top left;
    will-change: transform;
  }

  /* ================= LANES ================= */
  .lanes-matrix {
    margin-top: 14px;
    display: grid;
    gap: var(--gap);
    /* columnas fijas por config, el ancho real lo pone JSX en width */
    grid-auto-rows: auto;
  }

  .lane-cell {
    min-height: 72px;
    &.empty { border: 1px dashed var(--border-2); border-radius: var(--radius-md); background: var(--surface-2); }
    &.wrap { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); box-shadow: 0 8px 24px rgba(2,6,23,.06); overflow: hidden; }
    &.activa { box-shadow: 0 12px 36px rgba(2,6,23,.1); }
  }

  .lane-head {
    --lane: #6b7280;
    --lane-rgba: rgba(107,114,128,.08);
    --carrier: #6b7280;
    --carrier-rgba: rgba(107,114,128,.14);
    --sel-ring: rgba(107,114,128,.35);

    position: relative;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 10px;

    background: linear-gradient(180deg, var(--surface), var(--lane-rgba));
    padding: 14px;
    border: 0;
    cursor: pointer;
    text-align: left;

    .lane-tape { position: absolute; left: 0; right: 0; top: 0; height: 6px; background: linear-gradient(90deg, var(--lane), color-mix(in srgb, var(--lane) 50%, white)); }

    &::after { content:''; position: absolute; inset: 0; border-radius: inherit; box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--carrier) 40%, #fff); pointer-events: none; }

    &:hover { box-shadow: 0 0 0 4px var(--sel-ring) inset; }

    .lane-title { font-weight: 900; color: var(--elev); font-size: 16px; }
    .lane-title mark { background: color-mix(in srgb, var(--brand) 18%, #fff); border-radius: 4px; padding: 0 2px; }

    .lane-qty { justify-self: end; display: inline-grid; gap: 2px; text-align: right; }
    .lane-qty b { font-size: 18px; font-weight: 900; color: var(--elev); }
    .lane-qty i { font-size: 11px; font-style: normal; color: var(--muted); font-weight: 700; }
    .lane-qty.zero b { color: #94a3b8; }

    .chev { color: var(--muted); transition: transform .2s ease; }
  }

  .lane-visor { transition: max-height .28s ease, opacity .18s ease; overflow: hidden; padding: 0 14px 12px; }
  .lista-paquetes { margin: 10px 0 0; padding: 0; list-style: none; display: grid; gap: 10px; }
  .lista-paquetes .paquete { border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--surface-2); padding: 10px 12px; display: grid; gap: 8px; }
  .lista-paquetes .cliente { font-weight: 900; color: var(--elev); }
  .lista-paquetes .meta { display: flex; gap: 8px; flex-wrap: wrap; }
  .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: var(--surface); color: var(--elev); font-weight: 800; }
  .pill.estado.warn { background: color-mix(in srgb, var(--warning) 16%, #fff); border-color: color-mix(in srgb, var(--warning) 30%, #fff); color: color-mix(in srgb, var(--warning) 55%, #000); }
  .pill--carrier { --comp: var(--brand); --comp-rgba: var(--brand-rgba); background: var(--comp-rgba); border-color: color-mix(in srgb, var(--comp) 36%, #fff); color: color-mix(in srgb, var(--comp) 88%, #000); }
  .pill--carrier .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--comp); box-shadow: 0 0 0 2px color-mix(in srgb, var(--comp) 40%, #fff); }

  /* ================= RACKS ================= */
  .grid-estantes {
    margin-top: 14px;
    display: grid;
    gap: var(--gap);
    grid-template-columns: var(--rack-cols, repeat(1, var(--rack-cell-w)));
    /* el ancho total (px) lo establece JSX -> evita overflow y permite scale */
  }

  .estante--placeholder {
    border: 1px dashed var(--border-2); border-radius: var(--radius-md); background: var(--surface-2);
    min-height: 120px;
  }

  .columna {
    border: 1px solid var(--border); border-radius: var(--radius-lg);
    background: var(--surface); box-shadow: 0 8px 24px rgba(2,6,23,.06); overflow: hidden;

    .cabecera-estante {
      position: sticky; top: 0; z-index: 2;
      background: linear-gradient(180deg, var(--surface-2), var(--surface));
      border-bottom: 1px solid var(--border);
      padding: 12px 12px 10px;
      .tit { display: flex; align-items: center; gap: 10px; }
      .titulo { font-weight: 900; color: var(--elev); }
      .contador { margin-left: auto; font-weight: 900; color: var(--muted); }
      .mini-progress { margin-top: 8px; display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
      .mini-progress .bar { height: 6px; background: var(--surface-2); border: 1px solid var(--border); border-radius: 999px; overflow: hidden; }
      .mini-progress .bar span { display: block; height: 100%; background: linear-gradient(90deg, color-mix(in srgb, var(--brand) 85%, #fff), var(--brand)); transition: width .3s ease; }
      .mini-progress .pct { font-size: 12px; color: var(--muted); font-weight: 800; }
    }

    .baldas { padding: 12px; }
    .balda-wrapper { border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--surface-2); margin-bottom: 10px; overflow: hidden; }
    .balda-wrapper.activa { box-shadow: 0 8px 22px rgba(2,6,23,.08); }

    .balda {
      --carrier: #6b7280;
      --carrier-rgba: rgba(107,114,128,.14);
      width: 100%; border: 0; text-align: left; cursor: pointer;
      background: linear-gradient(180deg, var(--surface), var(--carrier-rgba));
      padding: 12px; display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 10px; position: relative;
      &::after { content:''; position: absolute; inset: 0; border-radius: inherit; box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--carrier) 40%, #fff); pointer-events: none; }
      .codigo { font-weight: 900; color: var(--elev); }
      .codigo mark { background: color-mix(in srgb, var(--brand) 18%, #fff); border-radius: 4px; padding: 0 2px; }
      .qty { justify-self: end; display: inline-grid; gap: 2px; text-align: right; }
      .qty b { font-size: 16px; font-weight: 900; color: var(--elev); }
      .qty i { font-size: 11px; font-style: normal; color: var(--muted); font-weight: 700; }
      .qty.zero b { color: #94a3b8; }
      .chev { color: var(--muted); transition: transform .2s ease; }
    }

    .visor-paquetes { transition: max-height .28s ease, opacity .18s ease; overflow: hidden; padding: 0 12px 10px; }

    .lista-paquetes { margin: 8px 0 0; padding: 0; list-style: none; display: grid; gap: 8px; }
    .lista-paquetes .paquete { border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface); padding: 10px 12px; display: grid; gap: 6px; }
    .lista-paquetes .cliente { font-weight: 900; color: var(--elev); }
    .lista-paquetes .meta { display: flex; gap: 8px; flex-wrap: wrap; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: var(--surface-2); color: var(--elev); font-weight: 800; }
    .pill.estado.warn { background: color-mix(in srgb, var(--warning) 16%, #fff); border-color: color-mix(in srgb, var(--warning) 30%, #fff); color: color-mix(in srgb, var(--warning) 55%, #000); }
    .pill--carrier { --comp: var(--brand); --comp-rgba: var(--brand-rgba); background: var(--comp-rgba); border-color: color-mix(in srgb, var(--comp) 36%, #fff); color: color-mix(in srgb, var(--comp) 88%, #000); }
    .pill--carrier .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--comp); box-shadow: 0 0 0 2px color-mix(in srgb, var(--comp) 40%, #fff); }
  }

  /* accesibilidad */
  :where(button, [role="tab"], [role="option"]) { &:focus-visible { outline: none; box-shadow: 0 0 0 4px var(--brand-ring); } }
  @media (prefers-reduced-motion: reduce) {
    .lane-visor, .visor-paquetes { transition: none; }
    .fit-wrapper > .grid-estantes, .fit-wrapper > .lanes-matrix { transform: none !important; }
  }
}
