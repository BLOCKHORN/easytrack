/* ==========================================================================
   BuscarPaquete.scss — Header pro, KPIs, filtros cohesionados, tabla pulida.
   TODO el estilo está scopeado a .buscar-paquete
   ========================================================================== */

.buscar-paquete {
  /* ---------- Tokens locales (no globales) ---------- */
  isolation: isolate;
  position: relative;
  z-index: 0;
  color-scheme: light;

  --surface:   #ffffff;
  --surface-2: #f6f8fb;
  --surface-3: #f1f5f9;
  --border:    #e6ebf2;

  --text:      #0f172a;
  --muted:     #64748b;

  --primary:   #4f46e5;
  --primary-2: #7c6cf4;
  --ring:        rgba(79, 70, 229, .28);
  --ring-strong: rgba(79, 70, 229, .55);

  --success:   #16a34a;
  --warning:   #f59e0b;
  --danger:    #ef4444;

  --radius-xs:  8px;
  --radius-sm: 10px;
  --radius-md: 16px;
  --radius-lg: 20px;

  --gap-2:     12px;
  --gap-3:     16px;

  --shadow-1:  0 6px 18px rgba(17, 24, 39, 0.08);
  --shadow-2:  0 14px 40px rgba(17, 24, 39, 0.12);

  color: var(--text);

  /* ───────────────── Header / H1 + KPIs ───────────────── */
  .titulo-flex {
    position: relative;
    z-index: 20;

    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--gap-3);

    margin-bottom: 18px;
    padding: 16px 18px;

    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    background:
      radial-gradient(120% 140% at -10% -20%, rgba(79, 70, 229, .10), transparent 50%),
      radial-gradient(100% 120% at 110% 10%, rgba(124,108,244,.08), transparent 40%),
      var(--surface);
    box-shadow: var(--shadow-1);
    transition: border-color .2s ease, box-shadow .2s ease;

    &:hover { border-color: #dee5f0; box-shadow: 0 10px 26px rgba(17, 24, 39, 0.10); }

    h2 {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin: 0;
      font-weight: 800;
      font-size: 22px;
      letter-spacing: -0.01em;
      color: var(--text);

      .icono-titulo {
        color: var(--primary);
        filter: drop-shadow(0 2px 6px rgba(79,70,229,.25));
      }
    }

    .kpis {
      display: grid;
      grid-auto-flow: column;
      gap: 14px;
      align-items: center;

      .kpi {
        display: grid;
        justify-items: end;
        gap: 4px;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 999px;
        background: #fff;
        min-width: 90px;

        .kpi-label {
          color: var(--muted);
          font-size: 11px;
          letter-spacing: .08em;
          text-transform: uppercase;
        }
        .kpi-value {
          font-weight: 800;
          font-size: 18px;
          line-height: 1;
        }
      }

      .progress {
        position: relative;
        width: 220px;
        height: 12px;
        border-radius: 999px;
        background: var(--surface-3);
        border: 1px solid var(--border);
        overflow: hidden;

        .bar {
          height: 100%;
          border-radius: inherit;
          background: linear-gradient(90deg, var(--primary), var(--primary-2));
          box-shadow: inset 0 -1px 0 rgba(255,255,255,.4);
          transition: width .28s ease;
        }
        .progress-text {
          position: absolute;
          right: 0;
          top: calc(100% + 6px);
          font-size: 12px;
          color: var(--muted);
        }
      }
    }
  }

  /* ───────────────── Filtros superiores ───────────────── */
  .filtros-superiores {
    position: relative;
    z-index: 30;

    display: grid;
    grid-template-columns: 1.8fr auto auto auto auto;
    gap: var(--gap-2);
    align-items: center;
    margin-bottom: var(--gap-3);

    /* Searchbox con icono y dropdown propio */
    .searchbox {
      position: relative;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;

      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 12px;
      box-shadow: var(--shadow-1);

      .magnifier {
        position: absolute;
        left: 12px;
        color: #9aa6b2;
        pointer-events: none;
      }

      input {
        border: 0;
        outline: 0;
        background: transparent;
        padding: 8px 10px 8px 32px;
        font: inherit;
        color: var(--text);
        &::placeholder { color: #9aa6b2; }
      }

      .clear {
        border: 0;
        background: var(--surface-3);
        color: var(--muted);
        padding: 8px 10px;
        border-radius: 999px;
        cursor: pointer;
        transition: background .15s ease;
        &:hover { background: #eef2f7; }
      }

      .suggestions {
        position: absolute;
        inset: auto 0 0 0;
        transform: translateY(calc(100% + 8px));
        list-style: none;
        margin: 0;
        padding: 8px;
        border: 1px solid #e8ecf3;
        border-radius: 12px;
        background: #fff;
        box-shadow: var(--shadow-2);
        z-index: 999;
        max-height: 260px;
        overflow: auto;

        li {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 8px 10px;
          border-radius: 10px;
          cursor: pointer;
          transition: background .14s ease, transform .08s ease;
          color: var(--text);
          svg { color: #9aa6b2; }
          &:hover { background: #f5f7ff; }
          &:active { transform: scale(.98); }
        }
      }
    }

    /* Botonera segmentada */
    .segmented {
      display: grid;
      grid-template-columns: auto auto auto;
      gap: var(--gap-2);
      align-items: center;

      .segmented__label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--muted);
        font-size: 13px;
      }

      .segmented__group {
        display: inline-flex;
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 4px;
        box-shadow: inset 0 -1px 0 rgba(17,24,39,.03);

        button {
          border: 0;
          background: transparent;
          padding: 6px 12px;
          border-radius: 999px;
          font: inherit;
          color: var(--text);
          cursor: pointer;
          transition: background .16s ease, border-color .16s ease, transform .06s ease;

          &.active {
            background: #eef2ff;
            border: 1px solid #dbe2ff;
            box-shadow: 0 1px 0 rgba(16,24,40,.02);
          }
          &:hover { background: #f3f6fc; }
          &:active { transform: translateY(1px); }
        }

        &.sensitivity { gap: 6px; }
      }
    }

    /* Selects nativos: SOLO dentro de .buscar-paquete */
    select {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--surface-3);
      padding: 10px 12px;
      font: inherit;
      color: var(--text);
      outline: none;
      transition: .18s ease;

      &:hover { background-color: #eef2f7; }
      &:focus { border-color: var(--ring-strong); box-shadow: 0 0 0 4px var(--ring); }
    }
  }

  /* ───────────────── Chips de filtros ───────────────── */
  .chips {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--gap-2);
    align-items: center;
    margin-bottom: var(--gap-3);

    .chips-label {
      color: var(--muted);
      display: inline-flex;
      gap: 8px;
      align-items: center;
      font-size: 13px;
    }

    .chips-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface);
        cursor: pointer;
        transition: .14s ease;
        font-size: 13px;
        svg { opacity: .8; }
        &:hover { background: #f5f7ff; border-color: #dbe2ff; }
      }

      .clear-all {
        background: #fff7e6;
        border-color: #ffe8b0;
        color: #7c5a04;
        &:hover { background: #fff1d6; }
      }
    }
  }

  /* ───────────────── Resultados / Tabla ───────────────── */
  .tabla-wrapper {
    position: relative;
    z-index: 1;                /* debajo de filtros */
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: var(--shadow-1);
    overflow: visible;         /* importante para dropdowns/hover */
    padding-bottom: 6px;
  }

  .tabla-paquetes {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    table-layout: fixed;

    thead th {
      text-align: left;
      font-weight: 700;
      padding: 12px 14px;
      background: var(--surface-2);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 2;
      user-select: none;
      color: #0b1324;
      transition: background .12s ease;

      &:not(:last-child) { cursor: pointer; }
      &:hover { background: #eef2f7; }
    }
    thead th:last-child { text-align: right; cursor: default; }

    thead th.asc::after,
    thead th.desc::after {
      content: "";
      display: inline-block;
      margin-left: 6px;
      border: 5px solid transparent;
    }
    thead th.asc::after  { border-bottom-color: var(--primary); transform: translateY(-2px); }
    thead th.desc::after { border-top-color: var(--primary);    transform: translateY( 2px); }

    tbody td {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      background: transparent;
    }

    tbody tr:nth-child(odd) { background: #fcfdff; }
    tbody tr:hover { background: #f7f9ff; }

    /* banda lateral + tinte si hay color de carril */
    tbody tr.lane-tinted td:first-child {
      position: relative;
      box-shadow: inset 4px 0 0 var(--lane, transparent);
      background-image: linear-gradient(0deg, var(--lane-rgba, transparent), var(--lane-rgba, transparent));
    }

    /* resaltado del fuzzy */
    .cliente mark {
      background: #fef3c7;
      border-radius: 4px;
      padding: 0 2px;
    }

    /* etiqueta ubicación */
    .ubi {
      display: inline-flex;
      align-items: center;
      gap: 8px;

      &.lane {
        position: relative;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #fff;
        box-shadow: 0 1px 0 rgba(16,24,40,.02);
      }
      &.lane::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: var(--lane-rgba, transparent);
        pointer-events: none;
      }
      .lane-dot {
        width: 10px; height: 10px; border-radius: 999px; background: var(--lane, #f59e0b);
        box-shadow: 0 0 0 2px #fff, 0 0 0 3px var(--lane-rgba, rgba(245,158,11,.25));
      }
    }

    /* Estado */
    .badge-estado {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;

      &.pendiente { background: #fff7e6; color: #7c5a04; border: 1px solid #ffe0a3; }
      &.entregado { background: #ecfdf5; color: #065f46; border: 1px solid #cdeeda; }
    }

    /* Acciones */
    tbody td.acciones { text-align: right; }
    .acciones .icono {
      margin-left: 8px;
      border: 0;
      cursor: pointer;
      padding: 8px;
      border-radius: 12px;
      background: #eef2ff;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      color: #21316d;
      box-shadow: 0 2px 10px rgba(79,70,229,.12);

      &:hover { transform: translateY(-1px); background: #e4e8ff; box-shadow: 0 6px 18px rgba(79,70,229,.18); }
      &:focus-visible { outline: 3px solid var(--ring-strong); outline-offset: 2px; }

      &.editar   { background: #e0f2fe; color: #0369a1; }
      &.entregar { background: #dcfce7; color: #166534; }
      &.eliminar { background: #fee2e2; color: #b91c1c; }
      svg { display:block; width: 16px; height: 16px; }
    }
  }

  /* ───────────────── Paginación ───────────────── */
  .paginacion {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: var(--gap-2);
    margin-top: var(--gap-3);

    button {
      border: 0;
      padding: 8px 12px;
      border-radius: 10px;
      color: #fff;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      box-shadow: 0 6px 16px rgba(95,119,255,.25);
      cursor: pointer;
      transition: transform .08s ease, filter .16s ease;

      &:hover { filter: brightness(1.05); }
      &:active { transform: translateY(1px); }
      &:disabled { opacity: .5; cursor: not-allowed; box-shadow: none; }
    }

    span { text-align: center; color: var(--muted); }
  }

  /* ───────────────── Estados / loaders ───────────────── */
  .estado-cargando .skeleton-row {
    height: 46px;
    border-radius: 12px;
    background: linear-gradient(90deg, #eef2f7, #f6f8fb 40%, #eef2f7 80%);
    background-size: 200% 100%;
    animation: skel 1.2s infinite linear;
    &:not(:last-child) { margin-bottom: 10px; }
  }
  @keyframes skel { to { background-position: -200% 0; } }

  .estado-error {
    background: #fff1f2;
    color: #9f1239;
    border: 1px solid #fecdd3;
    padding: 12px 14px;
    border-radius: 12px;
  }

  .estado-vacio {
    display: grid;
    place-items: center;
    gap: 10px;
    color: var(--muted);
    padding: 18px;
    border: 1px dashed var(--border);
    border-radius: 14px;
    background: var(--surface-2);

    .empty-actions {
      display: flex; gap: 8px; flex-wrap: wrap;
      button {
        border: 1px solid var(--border);
        background: var(--surface);
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        &:hover { background: #f5f7ff; }
      }
    }
  }

  /* ───────────────── Modal edición ───────────────── */
  .modal-edicion {
    position: fixed;
    inset: 0;
    z-index: 60;
    background: rgba(15, 23, 42, .28);
    display: grid;
    place-items: center;
    padding: 20px;

    .modal-contenido {
      width: min(560px, 96vw);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-2);
      padding: 18px;

      h3 {
        margin: 0 0 12px;
        font-size: 20px;
        font-weight: 800;
        color: var(--text);
      }

      label {
        display: grid;
        gap: 6px;
        margin: 10px 0;

        span { font-size: 13px; color: var(--muted); }
        input, select {
          width: 100%;
          border-radius: 10px;
          border: 1px solid var(--border);
          background: var(--surface-3);
          padding: 10px 12px;
          font: inherit;
          color: var(--text);
          outline: none;
          transition: .18s ease;

          &:hover { background: #eef2f7; }
          &:focus { border-color: var(--ring-strong); box-shadow: 0 0 0 4px var(--ring); }
        }
      }

      .modal-acciones {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 12px;

        .guardar {
          border: 0;
          padding: 10px 14px;
          border-radius: 12px;
          color: #fff;
          background: linear-gradient(135deg, var(--primary), var(--primary-2));
          box-shadow: 0 8px 18px rgba(95,119,255,.28);
          cursor: pointer;
        }
        .cancelar {
          border: 1px solid var(--border);
          background: var(--surface);
          padding: 10px 14px;
          border-radius: 12px;
          cursor: pointer;
          &:hover { background: #f5f7ff; }
        }
      }
    }
  }

  /* ───────────────── Confirmación ───────────────── */
  .bp-confirm {
    position: fixed;
    inset: 0;
    z-index: 70;
    background: rgba(15, 23, 42, .35);
    display: grid;
    place-items: center;
    padding: 20px;

    .bp-confirm__panel {
      width: min(440px, 92vw);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow-2);
      padding: 16px 18px;

      h4 { margin: 0 0 6px; font-size: 18px; font-weight: 800; color: var(--text); }
      p  { margin: 0 0 12px; color: var(--muted); }

      .bp-confirm__actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;

        .btn { padding: 8px 12px; border-radius: 10px; cursor: pointer; }
        .btn--muted  { border: 1px solid var(--border); background: var(--surface); }
        .btn--danger { border: 0; background: #ef4444; color: #fff; }
      }
    }
  }

  /* ───────────────── Toasts ───────────────── */
  .toasts {
    position: fixed;
    right: 18px;
    bottom: 18px;
    z-index: 80;
    display: grid;
    gap: 10px;

    .toast {
      background: var(--surface) !important;
      border: 1px solid var(--border);
      border-left-width: 4px;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: var(--shadow-1);
      min-width: 240px;
      animation: bp-toast .22s ease both;

      color: var(--text) !important;
      * { color: inherit; }

      &.info    { border-left-color: var(--primary); }
      &.success { border-left-color: var(--success); }
      &.error   { border-left-color: var(--danger); }
    }
  }
  @keyframes bp-toast {
    from { transform: translateY(8px); opacity: 0; }
    to   { transform: translateY(0);  opacity: 1; }
  }

  /* ───────────────── Cards móvil ───────────────── */
  .cards-m { display: none; }

  /* ───────────────── Responsive ───────────────── */
  @media (max-width: 980px) {
    .filtros-superiores { grid-template-columns: 1fr; }
    .titulo-flex { grid-template-columns: 1fr; row-gap: 10px; }
    .titulo-flex .kpis { grid-auto-flow: row; grid-template-columns: repeat(3, auto); }
  }

  @media (max-width: 860px) {
    .tabla-paquetes { display: none; }
    .cards-m { display: grid; gap: 12px; padding: 8px; }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow-1);
      padding: 12px 12px 10px;

      &.lane-tinted {
        background-image: linear-gradient(0deg, var(--lane-rgba, transparent), var(--lane-rgba, transparent));
      }

      .card__head { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 6px; }
      .card__title { margin: 0; font-weight: 700; color: var(--text); }
      .card__row { display: grid; grid-template-columns: 110px 1fr; gap: 8px; margin: 6px 0; }
      .label { color: var(--muted); }
      .card__actions { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }

      .btn { border: 1px solid var(--border); padding: 8px 10px; border-radius: 10px; background: #fff; cursor: pointer; }
      .btn--primary { color: #fff; background: linear-gradient(135deg, var(--primary), var(--primary-2)); border: 0; }
      .btn--ghost { background: #f3f6fc; }
      .btn--danger-ghost { background: #fee2e2; border-color: #fca5a5; }
    }
  }

  @media (prefers-reduced-motion: reduce) {
    * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; }
  }
}
